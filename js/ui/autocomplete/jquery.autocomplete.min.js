(function(d){var a=null,e=null,c=null,b=null;a={},e={data:null,idGetter:null,idSetter:null,zhGetter:null,queryGetter:null,afterClose:null,afterSelect:null,itemMouseOver:null,itemMouseOut:null,comparator:null,listContainer:"",listClass:"acPanel",itemClass:"acItem",hoverItemClass:"hover",changeAnimate:"easeOutBack",blurTriggerEventName:"mousedown",changeAnimateTime:300,changeAnimateDelay:200,closeAnimate:null,closeAnimateTime:150,closeAnimateDelay:50,blurInputTriggerClose:true,blurInputCloseDelay:1000,setTextWhenSelect:true,keyDownCallback:null,keyUpCallback:null,focusCallback:null,blurCallback:null,batchVerdict:function(f){return f instanceof Array}},c={keyDown:"keydown.auto_complete",keyUp:"keyup.auto_complete",focus:"focus.auto_complete",blur:"blur.auto_complete",options:"auto-complete-options"},b={addData:function(i){var h=b.getOptions.call(this,null);if(h.batchVerdict(i)){var g=b.modifyData.call(this,i),j=h.idGetter,f={};d.each(g,function(k,l){f[j(l)]=l});d.each(i,function(k,l){if(f[j(l)]===undefined){h.data.push(l)}})}else{if(!b.modifyData.call(this,i)){h.data.push(i)}}b._sort.call(this,null)},removeData:function(j){var k=b.getOptions.call(this,null);if(j instanceof Array){var i={},g=[],f=[],l=k.idGetter;d.each(k.data,function(m,n){i[l(n)]=n});d.each(j,function(m,n){f.push(i[n]);delete i[n]});d.each(k.data,function(m,n){var p=l(n);if(i[p]!==undefined){g.push(i[p])}});k.data=g;return f}else{var h=b.getIndexById.call(this,j),g=k.data[h];k.data.splice(h,1);return g}},modifyData:function(j){var i=b.getOptions.call(this,null);if(i.batchVerdict(j)){var g={},h=[],l=i.idGetter;d.each(i.data,function(m,n){g[l(n)]=n});d.each(j,function(m,n){var o=l(n);if(g[o]!==undefined){g[o]=n;h.push(n)}});d.each(i.data,function(m,n){var p=l(n);i.data[m]=g[p]});b._sort.call(this,null);return h}else{var k=i.idGetter(j),f=b.getIndexById.call(this,k);if(f>-1){i.data[f]=j;b._sort.call(this,null);return true}return false}},changeDataId:function(h,j){var g=b.getOptions.call(this,null),f=b.getIndexById.call(this,h);if(f>-1){var i=g.data[f];g.idSetter(i,j)}},getIndexById:function(h){var f=-1,g=b.getOptions.call(this,null);d.each(g.data,function(i,j){if(g.idGetter(j)===h){f=i;return false}});return f},getOptions:function(){return this&&this.data(c.options)},close:function(){var f=b.getOptions.call(this,null),h=d(f.listContainer),g=h.children("."+f.listClass);b._close.call(this,h,g,d.extend(b._getCloseAnimate.call(this,null),{delay:0}))},destory:function(){var f=b.getOptions.call(this,null);if(f&&f.blurTriggerEventName){d(document).unbind(f.blurTriggerEventName+".ac_"+f._identifier)}return this.removeData(c.options).unbind(c.keyDown).unbind(c.keyUp).unbind(c.focus).unbind(c.blur)},_generateIdentifier:function(){id=new Date().getTime();while(a[id]){id++}a[id]=true;return id},_init:function(f){var g=b;return this.each(function(){var h=d(this),i=d.extend({},e,f);i._identifier=g._generateIdentifier();i._selected=null;i._order=null;i._element=h;g.destory.call(h,null);h.data(c.options,i).bind(c.keyDown,function(j){if(d.isFunction(f.keyDownCallback)){f.keyDownCallback.call(this,j)}if(j.which===38){g._up.call(h,null)}else{if(j.which===40){g._down.call(h,null)}else{if(j.which===13){g._select.call(h,g._items.call(h,null).filter("."+i.hoverItemClass))}}}}).bind(c.keyUp,function(l){if(d.isFunction(f.keyUpCallback)){f.keyUpCallback.call(this,l)}if(l.which===27){b.close.call(h,null);return false}if(l.which===13||l.which===38||l.which===40){return false}var k=d(this),j=d.trim(k.val());if(j){g._match.call(h,j)&&g._create.call(h,null)}else{b.close.call(h,null)}}).bind(c.focus,function(k){if(d.isFunction(f.focusCallback)){f.focusCallback.call(this,k)}var m=d(i.listContainer),l=m.children("."+i.listClass),j=l.children();m.stop(true,true);if(j.length){g._changeSize(m,l,g._getChangeSizeAnimate.call(h,null))}else{h.trigger(c.keyUp)}}).bind(c.blur,function(k){if(d.isFunction(f.blurCallback)){f.blurCallback.call(this,k)}if(!i.blurInputTriggerClose){return}var m=d(i.listContainer),l=m.children("."+i.listClass),j=l.children(),n=function(){g._close.call(h,m,l,d.extend(g._getCloseAnimate.call(h,null),{delay:i.blurInputCloseDelay}))};if(j.length){n();d(i.listContainer).unbind(c.focus).unbind(c.blur).bind(c.focus,function(){m.stop(true,true)}).bind(c.blur,n)}});if(i.blurTriggerEventName){d(document).bind(i.blurTriggerEventName+".ac_"+i._identifier,function(j){if(j.target!==h[0]){h.trigger(c.blur)}})}g._sort.call(h,null)})},_sort:function(){var g=b.getOptions.call(this,null),f=g.comparator;if(g.data&&d.isFunction(f)){g.data.sort(f)}},_create:function(){var m=b,g=this,f=m.getOptions.call(g,null),h=d.isFunction(f.zhGetter)&&f.zhGetter;if(h&&f.listContainer){var o=d(f.listContainer);var j=f._identifier+"_acpanel";var p=o.find("#"+j);if(!p.length){p=d("<div/>").attr("id",j).addClass(f.listClass).appendTo(o).delegate("."+f.itemClass,"mouseenter",function(){m._hover.call(g,d(this).index())}).delegate("."+f.itemClass,"click",function(){m._select.call(g,this)})}var n=true,l=p.data("lastList");
if(l){if(l.length===f._order.length){for(var k=0;k<l.length;k++){if(!f._selected[l[k]]){break}else{if(k+1===l.length){n=false}}}}}if(n){p.empty().data("lastList",f._order);d.each(f._order,function(i,s){var r=f._selected[s];var q=h(r);d("<div/>").text(q).attr("title",q).attr("id",j+"_item_"+s).data("rsId",s).addClass(f.itemClass).appendTo(p)});m._hover.call(g,0);f._order.length?m._changeSize(o,p,m._getChangeSizeAnimate.call(g,null)):m.close.call(g,null)}return true}alert("参数缺失.");return false},_select:function(i){var f=d(i),g=this,h=b.getOptions.call(g,null),k=f.data("rsId");if(h.setTextWhenSelect){var j=d.isFunction(h.selectedZhGetter)?h.selectedZhGetter(h._selected[k]):f.text();g.val(j)}g.blur();d.isFunction(h.afterSelect)&&h.afterSelect(k);setTimeout(function(){b.close.call(g,null)},0)},_items:function(){var f=b.getOptions.call(this,null),h=d(f.listContainer),g=h.children("."+f.listClass);return g.children()},_hover:function(h){var i=b.getOptions.call(this,null),g=b._items.call(this,null),f=g.filter("."+i.hoverItemClass);if(h==null){return f.length>0?f.index():-1}else{h=Number(h);if(f.length){f.removeClass(i.hoverItemClass);d.isFunction(i.itemMouseOut)&&i.itemMouseOut(f.data("rsId"))}if(h>-1&&g.length>h){f=d(g.get(h)).addClass(i.hoverItemClass);d.isFunction(i.itemMouseOver)&&i.itemMouseOver(f.data("rsId"));return f}}},_adaptView:function(){var j=b.getOptions.call(this,null),g=b._items.call(this,null),f=g.filter("."+j.hoverItemClass);if(f&&f.length){var k=f.position().top,l=d(j.listContainer),i=l.height(),h=f.outerHeight();if(k<0){l.scrollTop(l.scrollTop()+k)}else{if(k+h>i){l.scrollTop(l.scrollTop()+k-i+h)}}}},_up:function(){var g=b._items.call(this,null),f=b._hover.call(this,null);if(f>-1){b._hover.call(this,(--f+g.length)%g.length);b._adaptView.call(this,null)}},_down:function(){var g=b._items.call(this,null),f=b._hover.call(this,null);b._hover.call(this,(f+1)%g.length);b._adaptView.call(this,null)},_changeSize:function(n,m,g){if(n.is(":hidden")){n.css({height:0}).show()}var j=m.outerHeight(true);var i,f=50,k=n.css("max-height")||0;if(k){var l=/(-?\d*\.?\d+)/.exec(k);k=l?Number(l[1])-f:0}i=j>k?k:j;if(n.data("lastHeight")!==i){n.data("lastHeight",i).stop(true,true).delay(g.delay).animate({height:i},g.time,g.name,function(){var o=d(this);o.css("height",i);var h=o.height()<j?"auto":"hidden";if(o.css("overflow-y")!==h){o.css("overflow-y",h)}})}},_close:function(i,h,f){if(i.is(":visible")){var g=b.getOptions.call(this,null);i.removeData("lastHeight");h.removeData("lastList");i.stop(true,true).delay(f.delay).animate({height:0},f.time,f.name,function(){d(this).hide();i.children("."+g.listClass).empty();d.isFunction(g.afterClose)&&g.afterClose()})}},_getChangeSizeAnimate:function(){var f=b.getOptions.call(this,null);return f&&{name:f.changeAnimate,time:f.changeAnimateTime,delay:f.changeAnimateDelay}},_getCloseAnimate:function(){var f=b.getOptions.call(this,null);return f&&{name:f.closeAnimate,time:f.closeAnimateTime,delay:f.closeAnimateDelay}},_match:function(i){var g=b.getOptions.call(this,null);if(g.data){var f=b._getRegExp(i.split(/\s+/)),j=d.isFunction(g.idGetter)&&g.idGetter,h=d.isFunction(g.queryGetter)&&g.queryGetter;if(j&&h){g._selected={};g._order=[];d.each(g.data,function(k,l){if(f.test(h(l))){var m=j(l);g._selected[m]=l;g._order.push(m)}});return true}}alert("参数缺失.");return false},_getRegExp:function(f){var g=/[\\\^\$\*\+\?\{\}\.\(\)\|\[\]\-]/g;d.each(f,function(i,j){f[i]=j.replace(g,function(k){return"\\"+k})});var h="^(?=[\\s\\S]*?"+f.join(")(?=[\\s\\S]*?")+")[\\s\\S]*$";return new RegExp(h,"i")}};d.fn.extend({autoComplete:function(){var f=arguments[0];if(b[f]){return b[f].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof f==="object"||!f){return b._init.apply(this,arguments)}else{d.error("Method "+f+" does not exist on jquery.autocomplete");return this}}}})})(jQuery);